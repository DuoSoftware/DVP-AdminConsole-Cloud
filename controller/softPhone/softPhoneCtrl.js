/** * Created by Damith on 2/16/2017. */mainApp.controller('softPhoneCtrl', function ($scope, softPhoneService, loginService,$anchorScroll,userProfileApiAccess,ShareData) {    //contact OBJ    $anchorScroll();    $scope.contactObj = {};    $scope.contactObj.type = "work";    $scope.isSaving = false;    $scope.businessUnits = [];    $scope.showAlert = function (title, type, content) {        new PNotify({            title: title,            text: content,            type: type,            styling: 'bootstrap3'        });    };    // $scope.contactList = [    //     {"contactname":"Jone Done","contactno":"+715986461","contacttype":"work"},    //     {"contactname":"Jone Done","contactno":"+715986461","contacttype":"home"},    //     {"contactname":"Jone Done","contactno":"+715986461","contacttype":"mobile"},    //     {"contactname":"Jone Done","contactno":"+715986461","contacttype":"work"},    //    // ];    $scope.isLoadinContacts = false;    var getAllContact = function () {        $scope.isLoadinContacts = true;        softPhoneService.getContact().then(function (response) {            console.log(response);            $scope.contactList = response.Result;        }, function (err) {            loginService.isCheckResponse(err);            console.log(err);        });        $scope.isLoadinContacts = false;    };    getAllContact();    $scope.addContact = function () {        console.log($scope.contactObj);        $scope.isSaving = true;        softPhoneService.createNewContact($scope.contactObj).then(function (res) {            $scope.showAlert('Soft Phone', 'success', 'Added New Contact Successfully');            $scope.isSaving = false;            $scope.contactObj = {};            $scope.contactObj.type = "work";            getAllContact();        });    };    $scope.updateContact = function () {        $scope.isUpdate = true;        softPhoneService.updateNewContact($scope.contactObj).then(function (res) {            if (res.Result) {                $scope.showAlert('Soft Phone', 'success', 'Contact Updated Successfully');                $scope.contactObj = {};                $scope.contactObj.type = "work";                getAllContact();                $scope.isShowUpdateView = false;            } else {                $scope.showAlert('Soft Phone', 'error', 'Contact Updated error.');            }            $scope.isUpdate = false;        });    };    $scope.deleteContact = function (contact) {        //delete contact        (new PNotify({            title: "Delete Contact",            text: "Do You Want to Delete This Contact ?",            icon: 'glyphicon glyphicon-question-sign',            hide: false,            confirm: {                confirm: true            },            buttons: {                closer: false,                sticker: false            },            history: {                history: false            }        })).get().on('pnotify.confirm', function () {            softPhoneService.deleteContact(contact._id).then(function (res) {                console.log(res);                if (res.IsSuccess) {                    $scope.showAlert('Soft Phone', 'success', 'Contact Deleted Successfully');                    getAllContact();                }            });        }).on('pnotify.cancel', function () {        });    };//update contact    $scope.showUpdateContactView = function (contact) {        softPhoneService.getIdByContact(contact._id).then(function (response) {            console.log(response);            if (response.Result) {                $scope.contactObj = response.Result;                $scope.isShowUpdateView = true;            } else {                $scope.showAlert('Soft Phone', 'error', 'Contact Edit error.');            }        }, function (err) {            loginService.isCheckResponse(err);            console.log(err);        });    };    $scope.closeUpdateView = function () {        $scope.contactObj = {};        $scope.isUpdate = false;        $scope.isShowUpdateView = false;    }    $scope.loadBusinessUnits = function () {        if(ShareData.BusinessUnits && ShareData.BusinessUnits.length>0)        {            $scope.businessUnits=ShareData.BusinessUnits        }        else        {            userProfileApiAccess.getBusinessUnits().then(function (resUnits) {                if(resUnits.IsSuccess)                {                    $scope.businessUnits=resUnits.Result;                }                else {                    $scope.showAlert("Business Unit","error","No Business Units found");                }            },function (errUnits) {                $scope.showAlert("Business Unit","error","Error in searching Business Units");            });        }    }    $scope.loadBusinessUnits();});